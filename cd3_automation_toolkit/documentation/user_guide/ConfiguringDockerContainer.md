## Configuring the Docker Container to connect to OCI Tenancy

Follow the below steps to configure the docker container to connect to a tenancy:
> ***Repeat this process for every new customer. Same container can be connected to multiple OCI tenancies.***

**Commands to execute inside the container:**
| Steps | Command |
| ----- | ------- |
| Change Directory to 'user-scripts' | <blockquote>**cd /cd3user/oci_tools/cd3_automation_toolkit/user-scripts/**</blockquote> |
| **API PEM keys:** If the key pair does not exist,create them using the script. | <blockquote>**python createAPIKey.py**</blockquote> |
| Upload the Public key to **"APIkeys"** under user settings inOCI Console. | Pre-requisite to use the complete functionality of the Automation Toolkit is to have the user as an administrator to the tenancy. <br><br>**Steps:**</br><ul><li>Open the Console, and sign in as the user.</li><li>View the details for the user who will be calling the API with the key pair.</li><li>Open the Profile menu (User menu icon) and click User Settings.</li><li>Click Add Public Key.</li><li>Paste the contents of the PEM public key in the dialog box and click Add.</li></ul>
| Enter the details to **tenancyconfig.properties** file | **tenancyconfig.properties**<br><br><blockquote>[Default]<br>#Mandatory Fields<br>#Friendly name for the Customer Tenancy eg: gctenancy;<br>#The generated .auto.tfvars will be prefixed with this customer name<br>customer_name=<br>tenancy_ocid=<br>fingerprint=<br>user_ocid=<br>#Path of API Private Key (PEM Key) File; If the PEM keys were generated by running createAPI.py,leave this field empty.<br>#Defaults to /cd3user/tenancies/keys/oci_api_private.pem when left empty.<br>key_path=<br>#Region ; defaults to us-ashburn-1 when left empty.<br>region=<br>#Optional Fields<br>#SSH Key to launched instances<br>ssh_public_key=</blockquote> |
| Initialise your environment to use the Automation Toolkit | <blockquote> **python createTenancyConfig.py tenancyconfig.properties** </blockquote>*If the API Keys were generated and added to the OCI console using the previous steps, it might take a couple of seconds to reflect. Thus, running the above command immediately might result in Authentication Errors.<br><br>In such cases, please retry after a minute.* |


**Files created on successfully completing the above steps - Description of the Generated files:**

| Files Generated | At File Path | Comment/Purpose |
| --------------- | ------------ | --------------- |
| Config File | ```/cd3user/tenancies/<customer_name>/<customer_name>_config``` | Customer specific Config file is required for OCI API calls. |
| setUpOCI.properties | ```/cd3user/tenancies/<customer_name>/<customer_name>_setUpOCI.properties``` | Customer Specific properties files will be created. |
| Region based directories | ```/rcd3user/tenancies/<customer_name>/terraform_files``` | Tenancy's subscribed regions based directories for the generation and segregation of terraform files. |
| Variables File,Provider File, Root and Sub modules | ```/cd3user/tenancies/<customer_name>/terraform_files/<region>``` | Required for terraform to work. |
| Public and Private Key Pair | Copied from ```/cd3user/tenancies/keys/```<br>to<br>```/cd3user/tenancies/<customer_name>/``` | API Keys that were previously generated are moved to customer specific out directory locations for easy access. |
| A log file with the commands to execute | ```/cd3user/tenancies/<customer_name>/cmds.log``` | This file contains a copy of the Commands to execute section of the console output. |
| Documentation folder | ```/cd3user/tenancies/<customer_name>/documentation/user_guide/```<br>```/cd3user/tenancies/<customer_name>/documentation/terraform/``` | These folders contain the .md files with instructions on how to use the toolkit and edit the .auto.tfvars. |
  
